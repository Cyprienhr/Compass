<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payroll</title>
  <link rel="stylesheet" href="/static/css/dashboard.css">
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <a class="nav-link" href="/dashboard/">Dashboard</a>
    </aside>
    <main class="content">
      <h1>Payroll Records</h1>

      <form method="get" action="" style="margin-bottom:12px; display:flex; gap:8px; align-items:center;">
        <label style="margin:0;">Choose date
          <input type="date" name="date" value="{{ selected_date }}">
        </label>
        <button type="submit">Load</button>
      </form>

      <form method="post" action="/payroll/bulk-upsert-for-date/">
        {% csrf_token %}
        <input type="hidden" name="date" value="{{ selected_date }}">

        <div class="card" style="margin-bottom:14px;">
          <strong>Employees worked on {{ selected_date }}</strong>
          <div class="table-wrapper">
            <table class="table">
              <thead>
                <tr>
                  <th>No</th>
                  <th>Name</th>
                  <th>National ID</th>
                  <th>Category</th>
                  <th>Amount</th>
                  <th>Deducted</th>
                  <th>Bonus</th>
                  <th>Contact</th>
                  <th>Status</th>
                  <th>Sign</th>
                </tr>
              </thead>
              <tbody>
                {% for row in date_rows %}
                <tr>
                  <td>{{ forloop.counter }}</td>
                  <td>{{ row.employee.full_name }}</td>
                  <td>{{ row.employee.national_id }}</td>
                  <td>{{ row.employee.category }}</td>
                  <td>{{ row.amount }}</td>
                  <td>{{ row.deducted }}</td>
                  <td>{{ row.bonus }}</td>
                  <td>{{ row.employee.contact }}</td>
                  <td>
                    <input type="hidden" name="employee_ids" value="{{ row.employee.id }}">
                    <select name="payment_status_{{ row.employee.id }}">
                      <option value="PENDING" {% if row.record and row.record.payment_status == 'PENDING' %}selected{% endif %}>Pending</option>
                      <option value="PAID" {% if row.record and row.record.payment_status == 'PAID' %}selected{% endif %}>Paid</option>
                      <option value="PARTIAL" {% if row.record and row.record.payment_status == 'PARTIAL' %}selected{% endif %}>Partial</option>
                    </select>
                  </td>
                  <td>
                    <label style="display:flex; align-items:center; gap:6px;">
                      <input type="checkbox" name="signature_{{ row.employee.id }}" value="true" {% if row.record and row.record.signature %}checked{% endif %}>
                      Signed
                    </label>
                  </td>
                </tr>
                {% empty %}
                <tr><td colspan="10">No employees worked on this date</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

        <button type="submit">Save all</button>
      </form>

    </main>
  </div>
</body>
</html>


